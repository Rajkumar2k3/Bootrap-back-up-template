<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y-Spot Admin</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.png">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
</head>
<body>
    <div id="wrapper">
        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="mx-3 d-none d-sm-block">
                    <img src="img/logo.png" alt="">
                </div>
            </a>
            <li class="nav-item active ">
                <a class="nav-link" href="index.html">
                    <i class=""><img src="img/sidebar-icons/person.png" alt=""></i>
                    <span>User Profile</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link bg-dark m-1" style="border-radius: 10px; width: 90%;" href="Hotels.html">
                    <i class=""><img src="img/sidebar-icons/food_bank.png" alt=""></i>
                    <span>Hotels</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="room.html">
                    <i class=""><img src="img/sidebar-icons/meeting_room.png" alt=""></i>
                    <span>Rooms</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="gustdetail.html">
                    <i class=""><img src="img/sidebar-icons/location_home.png" alt=""></i>
                    <span>Guest Details</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="payments.html">
                    <i class=""><img src="img/sidebar-icons/currency_rupee.png" alt=""></i>
                    <span>Payments</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="orders.html">
                    <i class=""><img src="img/sidebar-icons/format_list_bulleted.png" alt=""></i>
                    <span>Orders</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="reviews.html">
                    <i class=""><img src="img/sidebar-icons/stars.png" alt=""></i>
                    <span>Reviews</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="roomstatus.html">
                    <i class=""><img src="img/sidebar-icons/concierge.png" alt=""></i>
                    <span>Room Status</span></a>
            </li>
            <hr class="sidebar-divider d-none d-md-block">
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>
        </ul>
        <!-- End of Sidebar -->
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-3 static-top shadow">
                    <button id="sidebarToggleTop" class="btn btn-light d-md-none rounded-circle mr-2" style="background-color: #ff1717; color: #fff;">
                        <i class="fa fa-bars"></i>
                    </button>
                    <div class="bg-dark p-1 rounded d-md-none">
                        <img src="img/logo.png" alt="">
                    </div>
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Manager</span>
                                <img class="img-profile rounded-circle" src="img/undraw_profile.svg">
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Settings
                                </a>
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item" id="logout-button">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </button>
                            </div>
                        </li>
                    </ul>
                </nav>
                <!-- End of Topbar -->
                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <div class="border shadow-sm rounded-3 p-3">
                        <div class="rounded bg-white mb-2">
                            <form id="hotel-form">
                                <div class="text-center mt-2">
                                    <div class="">
                                        <input type="file" id="imageInput" accept="image/*" style="display: none;">
                                        <div class="preview-container">
                                            <h4 class="mt-2" style="color: #ff1717;"><b>Upload Property Images</b></h4>
                                            <img id="imagePreview" style="border-radius: 10px; height: 150px; width: 150px;" src="" alt="Upload Property Images">
                                        </div>
                                    </div>
                                </div>
                                <div class="row justify-content-center d-flex align-items-center">
                                    <div class="col-md-12">
                                        <div class="p-1 py-1">
                                            <div class="row mt-2 d-flex align-items-center justify-content-center">
                                                <div class="col-lg-5">
                                                    <label class="labels"><b>Hotel Name</b></label>
                                                    <input type="text" class="form-control" id="hotelName" placeholder="Hotel Name" value="">
                                                </div>
                                                <div class="col-lg-5">
                                                    <label class="labels"><b>Accommodation Types</b></label>
                                                    <input type="text" class="form-control" id="address" placeholder="Accommodation Types" value="">
                                                </div>
                                            </div>
                                            <div class="row mt-2 d-flex align-items-center justify-content-center">
                                                <div class="col-lg-5">
                                                    <label class="labels"><b>Location</b></label>
                                                    <input type="text" class="form-control" id="location" placeholder="Location" value="">
                                                </div>
                                                <div class="col-lg-5">
                                                    <label class="labels"><b>Room Price</b></label>
                                                    <input type="text" class="form-control" id="roomPrice" placeholder="Room Price" value="">
                                                </div>
                                            </div>
                                            <div class="row mt-2 d-flex align-items-center justify-content-center">
                                                <div class="col-lg-5">
                                                    <label class="labels"><b>Number of Rooms</b></label>
                                                    <input type="text" class="form-control" id="numberOfRooms" placeholder="Number of Rooms" value="">
                                                </div>
                                                <div class="col-lg-5">
                                                    <label class="labels"><b>Amenities</b></label>
                                                    <input type="text" class="form-control" id="amenities" placeholder="Amenities" value="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 text-center">
                                    <button class="btn" type="submit" style="background-color: #ff1717; color: #fff;"><b>Submit</b></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mt-3">
                            <div class="border p-3 bg-white">
                                <table class="table table-bordered table-striped table-hover">
                                    <thead class="bg-dark text-light">
                                        <tr>
                                            <th>Image</th>
                                            <th>Hotel Name</th>
                                            <th>Address</th>
                                            <th>Room Price</th>
                                            <th>Number of Rooms</th>
                                            <th>Amenities</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="hotelTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->
            </div>
            <!-- End of Main Content -->
            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>© 2023 Y-Spot. All rights reserved.</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Your Firebase configuration here
        const firebaseConfig = {
        apiKey: "AIzaSyCkTgEb7H_wNIgVhWwm-l-IzrHXDSe3ni4",
        authDomain: "testcrud-103a3.firebaseapp.com",
        databaseURL: "https://testcrud-103a3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "testcrud-103a3",
        storageBucket: "testcrud-103a3.appspot.com",
        messagingSenderId: "387302339276",
        appId: "1:387302339276:web:e6c88525a1d80f9d154869",
        measurementId: "G-ZR3EB3CD3Z"
      };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var firestore = firebase.firestore();
        var storage = firebase.storage();

        document.addEventListener("DOMContentLoaded", function () {
            var user = firebase.auth().currentUser;
            if (!user) {
                window.location.href = "login.html";
            }

            var hotelForm = document.getElementById("hotel-form");
            hotelForm.addEventListener("submit", function (e) {
                e.preventDefault();
                var hotelName = document.getElementById("hotelName").value;
                var address = document.getElementById("address").value;
                var location = document.getElementById("location").value;
                var roomPrice = document.getElementById("roomPrice").value;
                var numberOfRooms = document.getElementById("numberOfRooms").value;
                var amenities = document.getElementById("amenities").value;
                var imageInput = document.getElementById("imageInput").files[0];

                if (imageInput) {
                    var storageRef = storage.ref("images/" + imageInput.name);
                    storageRef.put(imageInput).then(function (snapshot) {
                        storageRef.getDownloadURL().then(function (url) {
                            firestore.collection("hotels").add({
                                hotelName: hotelName,
                                address: address,
                                location: location,
                                roomPrice: roomPrice,
                                numberOfRooms: numberOfRooms,
                                amenities: amenities,
                                imageUrl: url
                            }).then(function () {
                                alert("Hotel details submitted successfully!");
                                window.location.reload();
                            }).catch(function (error) {
                                console.error("Error adding document: ", error);
                            });
                        });
                    });
                } else {
                    firestore.collection("hotels").add({
                        hotelName: hotelName,
                        address: address,
                        location: location,
                        roomPrice: roomPrice,
                        numberOfRooms: numberOfRooms,
                        amenities: amenities
                    }).then(function () {
                        alert("Hotel details submitted successfully!");
                        window.location.reload();
                    }).catch(function (error) {
                        console.error("Error adding document: ", error);
                    });
                }
            });

            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    loadHotels();
                } else {
                    window.location.href = "login.html";
                }
            });

            function loadHotels() {
                firestore.collection("hotels").get().then((querySnapshot) => {
                    var hotelTableBody = document.getElementById("hotelTableBody");
                    hotelTableBody.innerHTML = "";
                    querySnapshot.forEach((doc) => {
                        var data = doc.data();
                        var row = document.createElement("tr");
                        row.innerHTML = `
                            <td><img src="${data.imageUrl || 'placeholder.png'}" alt="Hotel Image" width="100"></td>
                            <td>${data.hotelName}</td>
                            <td>${data.address}</td>
                            <td>${data.roomPrice}</td>
                            <td>${data.numberOfRooms}</td>
                            <td>${data.amenities}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteHotel('${doc.id}', '${data.imageUrl}')">Delete</button>
                            </td>
                        `;
                        hotelTableBody.appendChild(row);
                    });
                });
            }

            document.getElementById("imageInput").addEventListener("change", function () {
                var file = this.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById("imagePreview").src = e.target.result;
                    }
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById("logout-button").addEventListener("click", function () {
                firebase.auth().signOut().then(() => {
                    window.location.href = "login.html";
                }).catch((error) => {
                    console.error("Sign out error", error);
                });
            });
        });

        function deleteHotel(docId, imageUrl) {
            if (confirm("Are you sure you want to delete this hotel?")) {
                firestore.collection("hotels").doc(docId).delete().then(() => {
                    if (imageUrl) {
                        var storageRef = storage.refFromURL(imageUrl);
                        storageRef.delete().then(() => {
                            alert("Hotel deleted successfully!");
                            window.location.reload();
                        }).catch((error) => {
                            console.error("Error deleting image: ", error);
                        });
                    } else {
                        alert("Hotel deleted successfully!");
                        window.location.reload();
                    }
                }).catch((error) => {
                    console.error("Error deleting document: ", error);
                });
            }
        }
    </script>
</body>
</html>
